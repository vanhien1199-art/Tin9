<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#1479ff">
    <title>Tr·ª£ l√Ω Scratch - H·ªèi ƒë√°p</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root{
            --primary:#1479ff;
            --accent:#ffa940;
            --bg:#f4f7fc;
            --card:#fff;
            --text:#1a2455;
            --muted:#687293;
            --radius:14px;
            --shadow:0 8px 32px rgba(52,103,217,0.06);
            --input-height:56px;
        }

        /* Mobile-first base */
        html,body{height:100%;margin:0;background:linear-gradient(135deg,var(--bg) 0%, #e6f0ff 100%);font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:var(--text);-webkit-font-smoothing:antialiased}
        a{color:inherit}
        header {
            position:sticky;
            top:0;
            z-index:50;
            display:flex;
            align-items:center;
            gap:12px;
            padding:12px 14px;
            background:linear-gradient(90deg,var(--primary), #64b5f6 90%);
            color:#fff;
            box-shadow:var(--shadow);
            border-bottom-left-radius:10px;
            border-bottom-right-radius:10px;
            backdrop-filter: blur(6px);
            transition: transform .25s ease, opacity .25s ease;
            transform: translateY(0);
            opacity:1;
        }
        /* When header is hidden (during fullscreen), slide up */
        header.hidden {
            transform: translateY(-120%);
            opacity:0;
            pointer-events:none;
        }

        .home-btn{
            display:inline-flex;
            align-items:center;
            justify-content:center;
            width:44px;
            height:44px;
            border-radius:10px;
            background:rgba(255,255,255,0.06);
            color:#fff;
            text-decoration:none;
            font-size:1.1rem;
            flex:0 0 44px;
        }
        header h1{font-size:1.05rem;margin:0;font-weight:700;letter-spacing:-0.3px}

        /* Fullscreen toggle button in header */
        .fs-btn{
            margin-left:auto;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            width:44px;
            height:44px;
            border-radius:10px;
            background:rgba(255,255,255,0.06);
            color:#fff;
            border:none;
            cursor:pointer;
            flex:0 0 44px;
        }
        .fs-btn[aria-pressed="true"]{ background:rgba(255,255,255,0.13) }

        /* App wrapper that allows chat to fill screen */
        .app {
            display:flex;
            flex-direction:column;
            height:calc(100vh - 64px); /* header height approx */
            margin: 12px;
            transition: all .22s ease;
        }

        /* Fullscreen mode for .app (CSS overlay) */
        .app.fullscreen {
            position:fixed;
            top:0;
            left:0;
            right:0;
            bottom:0;
            margin:0;
            border-radius:0;
            z-index:9999;
            padding: env(safe-area-inset-top,12px) env(safe-area-inset-right,12px) env(safe-area-inset-bottom,12px) env(safe-area-inset-left,12px);
            background: linear-gradient(180deg,#fbfdff 0%, #ffffff 100%);
        }

        /* Floating close button visible in fullscreen */
        .fs-close {
            position:fixed;
            top: env(safe-area-inset-top,12px);
            right: env(safe-area-inset-right,12px);
            z-index:10010;
            display:none;
            align-items:center;
            justify-content:center;
            width:44px;
            height:44px;
            border-radius:10px;
            background:rgba(0,0,0,0.6);
            color:#fff;
            border:none;
            cursor:pointer;
            box-shadow:0 6px 20px rgba(0,0,0,0.25);
        }
        .fs-close.show { display:flex; }

        /* Card with chat content */
        .card {
            background:var(--card);
            border-radius:18px;
            box-shadow:var(--shadow);
            overflow:hidden;
            display:flex;
            flex-direction:column;
            flex:1 1 auto;
            min-height:0; /* important for flex children scroll */
        }

        /* Intro/description (collapsible on small screens) */
        .intro {
            padding:14px 16px;
            border-bottom:1px solid #eef3ff;
            display:flex;
            gap:12px;
            align-items:flex-start;
        }
        .intro .title{font-weight:700;color:var(--primary);font-size:0.98rem}
        .intro p{margin:6px 0 0;color:var(--muted);font-size:0.92rem;line-height:1.35}

        /* Chat window: flexible and scrollable */
        #chat-window {
            padding:12px 12px 14px;
            display:flex;
            flex-direction:column;
            gap:10px;
            overflow:auto;
            -webkit-overflow-scrolling:touch;
            flex:1 1 auto;
            background:linear-gradient(180deg,#fbfdff 0%, #ffffff 100%);
        }
        .chat-message{
            max-width:82%;
            padding:12px 14px;
            border-radius:18px;
            font-size:0.98rem;
            line-height:1.45;
            box-shadow:0 2px 10px rgba(18,45,93,0.04);
            word-break:break-word;
        }
        .ai-message{
            background:#f3f5fb;
            color:var(--text);
            align-self:flex-start;
            border-bottom-left-radius:8px;
            border-top-right-radius:8px;
        }
        .user-message{
            background:linear-gradient(90deg,var(--primary) 30%, #409fff 100%);
            color:#fff;
            align-self:flex-end;
            border-bottom-right-radius:8px;
            border-top-left-radius:8px;
        }

        /* Input area fixed to bottom inside card using sticky footer technique */
        .input-wrap {
            position:relative;
            background:linear-gradient(180deg, rgba(250,250,255,0.6), rgba(250,250,255,0.9));
            border-top:1px solid #eef3ff;
            padding:10px;
        }

        .chat-input {
            display:flex;
            gap:8px;
            align-items:center;
            padding:env(safe-area-inset-bottom,0) 0 0 0;
        }

        .chat-input input{
            flex:1;
            height:var(--input-height);
            border-radius:14px;
            border:1px solid #e2e8f7;
            padding:12px 14px;
            font-size:1rem;
            background:#fff;
            outline:none;
            transition:box-shadow .12s, border-color .12s;
        }
        .chat-input input:focus{
            border-color:var(--primary);
            box-shadow:0 4px 18px rgba(20,121,255,0.08);
        }

        .send-btn{
            width:54px;
            height:54px;
            background:var(--primary);
            color:#fff;
            border-radius:12px;
            display:inline-flex;
            align-items:center;
            justify-content:center;
            border:none;
            padding:0;
            cursor:pointer;
            box-shadow:0 6px 18px rgba(20,121,255,0.12);
            flex:0 0 54px;
        }

        .send-btn:active{transform:translateY(1px)}
        .send-btn svg{width:22px;height:22px;display:block}

        /* Small helper: show hint above input on mobile */
        .hint {
            font-size:0.82rem;
            color:var(--muted);
            padding:6px 12px 0;
        }

        /* Desktop/tablet adjustments */
        @media (min-width:700px){
            .container {
                max-width:980px;
                margin:32px auto;
                padding:0 28px 60px;
            }
            header{border-radius:18px;margin:0 32px}
            .app{height:calc(100vh - 140px); margin: 32px;}
            .intro p{font-size:1.05rem}
            .card{border-radius:18px;padding:0}
            .input-wrap{padding:18px}
            .chat-input input{height:56px}
            .send-btn{width:60px;height:56px;border-radius:16px}
            #chat-window{padding:18px}
            .fs-close { width:52px; height:52px; border-radius:12px; }
        }

        /* Accessibility / reduced motion */
        @media (prefers-reduced-motion: reduce){
            * {transition:none !important}
        }
    </style>
</head>
<body>
    <header id="site-header">
        <a href="/" class="home-btn" title="V·ªÅ trang ch·ªß" aria-label="V·ªÅ trang ch·ªß">üè†</a>
        <h1>Tr·ª£ l√Ω H·ªçc Scratch</h1>

        <!-- Fullscreen toggle button -->
        <button id="fs-toggle" class="fs-btn" aria-pressed="false" title="M·ªü ch·∫ø ƒë·ªô to√†n m√†n h√¨nh" aria-label="M·ªü ch·∫ø ƒë·ªô to√†n m√†n h√¨nh">
            <!-- expand icon -->
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M3 9V3h6"></path>
                <path d="M21 15v6h-6"></path>
                <path d="M21 3l-8 8"></path>
                <path d="M3 21l8-8"></path>
            </svg>
        </button>
    </header>

    <main class="app" role="main" id="app-root">
        <section class="card" aria-labelledby="chat-title">
            <div class="intro" id="chat-title">
                <div style="flex:1">
                    <div class="title">Tr·ª£ l√Ω Scratch</div>
                    <p class="desc">Xin ch√†o! M√¨nh l√† Mentor Scratch ‚Äî h·ªèi g√¨ c·ª© h·ªèi, m√¨nh s·∫Ω tr·∫£ l·ªùi b·∫±ng ng√¥n ng·ªØ d·ªÖ hi·ªÉu. Giao di·ªán ƒë√£ t·ªëi ∆∞u cho ƒëi·ªán tho·∫°i.</p>
                </div>
                <div style="flex:0 0 auto;align-self:center">
                    <!-- small icon -->
                    <svg width="44" height="44" viewBox="0 0 48 48" fill="none" aria-hidden="true">
                      <rect x="8" y="14" width="32" height="24" rx="12" fill="#1479ff"/>
                      <rect x="16" y="22" width="16" height="8" rx="4" fill="#fff"/>
                      <circle cx="18" cy="26" r="2" fill="#1479ff"/>
                      <circle cx="30" cy="26" r="2" fill="#1479ff"/>
                    </svg>
                </div>
            </div>

            <div id="chat-window" aria-live="polite" aria-relevant="additions">
                <div class="chat-message ai-message">
                    Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n h√¥m nay?
                </div>
            </div>

            <div class="input-wrap">
                <div class="hint">Nh·∫≠p c√¢u h·ªèi ho·∫∑c m√¥ t·∫£ d·ª± √°n, sau ƒë√≥ nh·∫•n G·ª≠i</div>
                <div class="chat-input" role="form" aria-label="Khu v·ª±c nh·∫≠p chat">
                    <input id="user-input" type="text" inputmode="text" autocomplete="off" placeholder="ƒê·∫∑t c√¢u h·ªèi b·∫•t k·ª≥..." aria-label="N·ªôi dung tin nh·∫Øn">
                    <button id="send-button" class="send-btn" aria-label="G·ª≠i tin nh·∫Øn" title="G·ª≠i">
                        <!-- send icon -->
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M22 2L11 13"></path>
                            <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- fullscreen close button (visible only in fullscreen) -->
    <button id="fs-close" class="fs-close" aria-label="Tho√°t to√†n m√†n h√¨nh" title="Tho√°t to√†n m√†n h√¨nh">‚úï</button>

    <footer style="display:none"></footer>

    <!-- Small script to improve mobile UX: auto-scroll, input focus on tap send, handle Enter key, fullscreen toggle -->
    <script>
    (function(){
        const chatWindow = document.getElementById('chat-window');
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-button');
        const app = document.getElementById('app-root');
        const fsToggle = document.getElementById('fs-toggle');
        const fsClose = document.getElementById('fs-close');
        const header = document.getElementById('site-header');

        function scrollToBottom(smooth=true){
            try {
                if (smooth) chatWindow.scrollTo({ top: chatWindow.scrollHeight, behavior: 'smooth' });
                else chatWindow.scrollTop = chatWindow.scrollHeight;
            } catch(e){ chatWindow.scrollTop = chatWindow.scrollHeight; }
        }

        // initial scroll
        setTimeout(()=>scrollToBottom(false), 100);

        // send handler (hooks into existing chatbot.js if present)
        function sendMessage(){
            const text = input.value.trim();
            if (!text) return;
            // add user message UI
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-message user-message';
            userBubble.textContent = text;
            chatWindow.appendChild(userBubble);
            input.value = '';
            scrollToBottom();

            // If chatbot.js provides a global sendToBot function, call it; otherwise, add placeholder reply
            if (typeof window.sendToBot === 'function') {
                window.sendToBot(text);
            } else if (typeof window.handleChatInput === 'function') {
                window.handleChatInput(text);
            } else {
                setTimeout(()=>{
                    const ai = document.createElement('div');
                    ai.className = 'chat-message ai-message';
                    ai.textContent = 'M√¨nh ƒë√£ nh·∫≠n ƒë∆∞·ª£c c√¢u h·ªèi c·ªßa b·∫°n: "' + text + '". (B·∫°n ch∆∞a k·∫øt n·ªëi chatbot th·ª±c t·∫ø)';
                    chatWindow.appendChild(ai);
                    scrollToBottom();
                }, 700);
            }
        }

        sendBtn.addEventListener('click', sendMessage);

        input.addEventListener('keydown', function(e){
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Mobile: focus input when tapping chat area
        chatWindow.addEventListener('click', () => { input.focus(); });

        // expose small helper so external scripts can append messages and auto-scroll
        window.appendBotMessage = function(text){
            const ai = document.createElement('div');
            ai.className = 'chat-message ai-message';
            if (typeof text === 'string') ai.textContent = text;
            else ai.appendChild(text);
            chatWindow.appendChild(ai);
            scrollToBottom();
        };

        // Fullscreen toggle (CSS-based overlay). Also hide header visually.
        function enterFullscreenMode(){
            app.classList.add('fullscreen');
            header.classList.add('hidden');
            fsToggle.setAttribute('aria-pressed','true');
            fsToggle.title = 'Tho√°t ch·∫ø ƒë·ªô to√†n m√†n h√¨nh';
            fsClose.classList.add('show');
            // focus input for quick typing
            setTimeout(()=>{ input.focus(); scrollToBottom(true); }, 120);
        }
        function exitFullscreenMode(){
            app.classList.remove('fullscreen');
            header.classList.remove('hidden');
            fsToggle.setAttribute('aria-pressed','false');
            fsToggle.title = 'M·ªü ch·∫ø ƒë·ªô to√†n m√†n h√¨nh';
            fsClose.classList.remove('show');
            // restore focus to input
            setTimeout(()=>{ input.focus(); scrollToBottom(true); }, 120);
        }
        fsToggle.addEventListener('click', function(){
            const isOn = app.classList.contains('fullscreen');
            if (isOn) exitFullscreenMode();
            else enterFullscreenMode();
        });
        fsClose.addEventListener('click', exitFullscreenMode);

        // allow ESC to exit fullscreen
        window.addEventListener('keydown', function(e){
            if (e.key === 'Escape' && app.classList.contains('fullscreen')) {
                exitFullscreenMode();
            }
        });

        // On resize (keyboard show/hide), keep view scrolled to bottom
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(()=> scrollToBottom(true), 150);
        }, {passive:true});

        // Optional: attempt browser Fullscreen API if you want real fullscreen (commented by default)
        // function requestBrowserFullscreen() {
        //     const el = document.documentElement;
        //     if (el.requestFullscreen) el.requestFullscreen();
        //     else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
        // }
        // function exitBrowserFullscreen() {
        //     if (document.exitFullscreen) document.exitFullscreen();
        //     else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        // }
        // You can combine CSS fullscreen with the Fullscreen API by calling requestBrowserFullscreen() inside enterFullscreenMode().

        // Backwards compatibility: if external chatbot script wants to append nodes & control scroll,
        // it can call window.appendBotMessage(...) which we provide above.

    })();
    </script>

    <!-- existing chatbot integration (kept) -->
    <script src="../shared/chatbot.js"></script>
</body>
</html>
